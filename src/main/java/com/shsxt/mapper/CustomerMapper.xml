<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper    
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"    
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.shsxt.dao.CustomerDao">
	
	<select id="selectForPage" resultType="customer">
		SELECT
				id,
				khno,
				`name`,
				area,
				cus_manager,
				LEVEL,
				myd,
				xyd,
				address,
				post_code,
				phone,
				fax,
				web_site,
				yyzzzch,
				fr,
				zczj,
				nyye,
				khyh,
				khzh,
				dsdjh,
				gsdjh,
				state,
				is_valid,
				create_date,
				update_date
			FROM
				t_customer
			<where>
				is_valid = 1 
				<if test="@Ognl@isNotEmpty(customerNo)">
					and khno like '%${customerNo}%'
				</if>
				<if test="@Ognl@isNotEmpty(customerName)">
					and NAME like '%${customerName}%'
				</if>
			</where>
			order by id desc
	</select>
	
	<insert id="insert" useGeneratedKeys="true" keyProperty="id">
		insert into t_customer (
				khno,
				`name`,
				area,
				cus_manager,
				LEVEL,
				myd,
				xyd,
				address,
				post_code,
				phone,
				fax,
				web_site,
				yyzzzch,
				fr,
				zczj,
				nyye,
				khyh,
				khzh,
				dsdjh,
				gsdjh,
				state,
				is_valid,
				create_date,
				update_date
			) VALUES (
				#{khno},
				#{name},
				#{area},
				#{cusManager},
				#{level},
				#{myd},
				#{xyd},
				#{address},
				#{postCode},
				#{phone},
				#{fax},
				#{webSite},
				#{yyzzzch},
				#{fr},
				#{zczj},
				#{nyye},
				#{khyh},
				#{khzh},
				#{dsdjh},
				#{gsdjh},
				#{state},
				#{isValid},
				#{createDate},
				#{updateDate}
			)
	</insert>
	
	<update id="update">
		UPDATE t_customer SET
			`name`=#{name},
			area=#{area},
			cus_manager=#{cusManager},
			LEVEL=#{level},
			myd=#{myd},
			xyd=#{xyd},
			address=#{address},
			post_code=#{postCode},
			phone=#{phone},
			fax=#{fax},
			web_site=#{webSite},
			yyzzzch=#{yyzzzch},
			fr=#{fr},
			zczj=#{zczj},
			nyye=#{nyye},
			khyh=#{khyh},
			khzh=#{khzh},
			dsdjh=#{dsdjh},
			gsdjh=#{gsdjh},
			update_date = #{updateDate}
		WHERE id = #{id}
	</update>
	
	<select id="findLossCustomer" resultType="customer">
		SELECT
			t.id, t.khno, t.cus_manager, t.`name`
		FROM
			t_customer t
		WHERE
			DATE_ADD(update_date, INTERVAL 6 MONTH) &lt;= NOW()
			AND state = 0
			AND id NOT IN (
				SELECT
					cus_id
				FROM
					t_customer_order
			)
	</select>
	
	<select id="findLossCustomerNoOrderLongTime" resultType="customer">
		SELECT
			t.id, t.khno, t.cus_manager, t.`name`
		FROM
			t_customer t
		WHERE
			id IN (
				SELECT
					cus_id
				FROM
					t_customer_order
				WHERE
					DATE_ADD(update_date, INTERVAL 6 MONTH) &lt;= NOW()
				)
		and state = 0
	</select>
</mapper>